@startuml
!define RECTANGLE component
skinparam componentStyle rectangle
skinparam shadowing false
skinparam defaultTextAlignment center

package "Frontend (Browser)" {
  RECTANGLE UI as "UI: Buttons & Forms"
  RECTANGLE Terminal as "xterm.js Terminal"
  RECTANGLE FrontDispatcher as "Command Dispatcher"

  UI --> FrontDispatcher : dispatch(uiEvent)
  Terminal --> FrontDispatcher : input(command)
}

package "Backend API" {
  RECTANGLE Router as "Command Router"
  RECTANGLE Registry as "Command Registry"
  RECTANGLE Executor as "Command Executor"
  RECTANGLE Logger
  RECTANGLE Auth as "Auth Middleware"
  RECTANGLE Context as "User Context Resolver"
  RECTANGLE Workspace as "User Workspace\n(512MB Volume)"

  FrontDispatcher --> Router : POST /command
  Router --> Auth
  Auth --> Context
  Context --> Executor
  Router --> Registry
  Registry --> Executor : handler()
  Executor --> Workspace : read/write
  Executor --> Logger
}

package "Live Stream & Logs" {
  RECTANGLE StreamService as "Log Stream Service"
  RECTANGLE ShellUI as "CLI Shell UI (Viewer)"

  Logger --> StreamService
  StreamService --> ShellUI : WebSocket logs
}

package "Services" {
  RECTANGLE AI as "AI Engine"
  RECTANGLE Search as "Search Index"
  RECTANGLE Audit as "Audit Trail Service"

  Executor --> AI : /ai
  Executor --> Search : /search
  Executor --> Audit : record(cmd)
}
@enduml
